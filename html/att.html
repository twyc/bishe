<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=dba359696d9128e480e86a54ca9944f1"></script> 
	<script type="text/javascript" src="host.js"></script>
    <script type="text/javascript" src="pagination.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.css" rel="stylesheet">
    <!-- 翻页组件 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅游景点信息集成模块</title>    
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="css/marketing.css">
    <style type="text/css">
    		body,html{
				width: 100%;
				height: 100%;
			}
    		#tabler{
				width: 20%;
				height: 100%;
				float: left;
			}
			#container{
				width: 80%;
				height: 650px;
			}
    </style>
</head>
<body>
	<div id="app">
		<div class="header">
	    <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
	        <a class="pure-menu-heading" href="index.html">首页</a>
	        <a class="pure-menu-heading" href="#">景点展示</a>
	        <a class="pure-menu-heading" href="attRecommend.html">景点推荐</a>
	        <a class="pure-menu-heading" href="route.html">路线查询</a>

	        <ul class="pure-menu-list">
	            <li class="pure-menu-item"><a class="pure-menu-link" v-text="name" type="button" @click="toUser()">{{name}}</a></li>
	            <li class="pure-menu-item"><a class="pure-menu-link" v-text="status" type="button" @click="changeStatus()">{{status}}</a></li>
	        </ul>
	    </div>
		</div>

		<div>
			<br>
			<br>
			<div id="tabler">
				<h2>景点列表</h2>
				<ul style="font-size: 18px">
					<li v-for="(it,index) in showItems" @click="fun(it)">
						<a href="#">
							{{ it.name }}
						</a>	
					</li>
				</ul>
	            <navigation :pages="pages" :current.sync="pageNo" @navpage="pageList"></navigation>
			</div>
			
			
			<div id="container"></div>	
		</div>
			

	</div>

</body>

<script type="text/javascript">
	var app = new Vue({
		el:"#app",
		data:{
			name:"请登录",
			status:"login",//"sign up"
			map:null,
			allItems : null,
			showItems : null,
			pageNo: 1,
            pages: 0,
            itemNum: 15
		},
		methods:{
			toUser:function(){
				if (this.status=="sign up") {
					window.location="user.html";
				}else{
					return;
				}
			},
			pageList:function(curPage) {
                //根据当前页获取数据
                this.pageNo = curPage;
                this.showItems = this.allItems.slice(this.itemNum*(this.pageNo-1)+1,this.itemNum*this.pageNo+1);
                console.log("当前页：" + this.pageNo);
            },
			changeStatus:function(){
				if (this.status=="login") {
					window.location="login.html";
				}else{
					this.name="请登录";
					this.status="login";
				}
			},
			fun:function(it){
				this.map.clearMap();
				var marker = new AMap.Marker({
				    position: new AMap.LngLat(it.latitude,it.longitude),
				    title: it.name
				});
				console.log(marker);
				console.log(this.map);
				marker.setLabel({
					offset: new AMap.Pixel(20,20),
					content:it.name
				});
				// 将创建的点标记添加到已有的地图实例：
				this.map.add(marker);
				this.map.setFitView(marker);

				//把这个景点的chart更新给user
				var url = "http://"+host+":"+port+"/user/updateChart?chart="+it.keywords;
				var that = this;
				axios.get(url,{
				withCredentials: true
				}).then(function (response){
					console.log(response.data.data);
				}).catch(function (error){
					console.log("error");
				});
			}
		},
		mounted:function() {
			var url = "http://"+host+":"+port+"/attraction/list";
			var that = this;
			axios.get(url,{
				withCredentials: true
			}).then(function (response){
				that.allItems = response.data.data.reverse();
				that.pages = Math.ceil(that.allItems.length/that.itemNum);
				that.showItems = that.allItems.slice(that.itemNum*(that.pageNo-1)+1,that.itemNum*that.pageNo+1);
			}).catch(function (error){
				console.log("error");
			});
			that.map = new AMap.Map('container', {
				resizeEnable: true,
			    center:[112.982279,28.19409],
			    zoom:11
	    	});
	    	url = "http://"+host+":"+port+"/user/getUser";
			axios.get(url,{
				withCredentials: true
			})
			.then(function (response) {
				console.log(response);
				var serverStatus = response.data.status;
				if (serverStatus=="not login") {
					return;
				}
				let user = response.data.data;
				that.isLogin = false;
				that.name = user.name;
				that.status = "sign up";
			})
			.catch(function (error) {
				console.log(error);
			});
		}

	});
</script>
</html>