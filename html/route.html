<!-- 
	旅游景点信息推荐模块
 	用户输入时间、预算、景点需求等相关信息，系统中的推荐引擎部分根据用户输入和第三方提供的实时天气信息返回个性化的景点及路线推荐结果。

 	前端显示一些选择器 然后传回服务端进行处理 得到值
 -->
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=dba359696d9128e480e86a54ca9944f1"></script> 
		<script type="text/javascript" src="host.js"></script>
		<style type="text/css">
			body,html{
				width: 100%;
				height: 100%;
			}
			#tabler{
				width: 20%;
				height: 100%;
				margin: auto;
				float: left;
			}
			#container{
				width: 80%;
				height: 100%;
				margin: auto;
				float: left;
			}
		</style>
		<title>旅游景点信息推荐模块</title>
	</head>

	<body>
		<div id="tabler">
			<div id="input">
		        想去的景点  <input placeholder="多个景点用空格分隔" v-model="attsWant">
		    	</form>
		    	<br>
		    	<button @click="onSubmit()">提交</button>
			</div>
	    	
	    	<div id="output">
	    		<ul>
					<li v-for="(it,index) in items">
						<a v-bind="{href:it.source}">第{{index+1}}条路线</a>：<a href="#" @click="showRoute(it.attsId)">{{it.attractions}}</a>
					</li>
				</ul>
	    	</div>
		</div>
		<div id="container"></div>

	</body>
</html>

<script type="text/javascript">
	var map = null;
	var app = new Vue({
			el:"#tabler",
			data:{
				attsWant : "",
				items : null
			},
		mounted:function() {
				map = new AMap.Map('container', {
				resizeEnable: true,
			    center:[112.982279,28.19409],
			    zoom:11
	    	});
		},
		methods:{
			onSubmit:function(){
				console.log(this.attsWant);
				var url = "http://"+host+":"+port+"/route/getRoute?attsWant="+this.attsWant;
				var that=this;
				axios.get(url)
				  .then(function (response) {
				  	that.items = response.data.data;
					console.log(that.items);
				  })
				  .catch(function (error) {
				    console.log(error);
				  });
			},
			showRoute:function(str){
				var loc = new Array(); 
				var arr = str.split("&");
				for(var i in arr){
					if (i==arr.length-1) {
						break;
					}
					var loca = arr[i].split(",");
					loc.unshift(new AMap.LngLat(Number(loca[0]),Number(loca[1])));
				}
				map.clearMap();
				loc.forEach(function(it,index,loc){
					var tit=null;
					if (index==0) {
						tit="start";
					}
					var marker = new AMap.Marker({
						position:it,
						title:tit
					});
					marker.setLabel({
						offset: new AMap.Pixel(20,20),
						content:tit
					});
					console.log(it);
					map.add(marker);
				})
				var line = new AMap.Polyline({
					path:loc,
					borderWeight:2,
					strokeColor:'red',
					lineJoin: 'round'
				});
				map.add(line);
			}
		}
	});
</script>